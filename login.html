<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lenovox AI - Login</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      perspective: 1000px;
      overflow-x: hidden;
    }

    /* ========== LOGIN CONTAINER ========== */
    .login-container {
      width: 100%;
      max-width: 420px;
      padding: 50px 40px;
      border-radius: 30px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.5);
      animation: slideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      transform-style: preserve-3d;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px) rotateX(20deg);
      }
      to {
        opacity: 1;
        transform: translateY(0) rotateX(0deg);
      }
    }

    /* LOGO & TITLE */
    .logo-section {
      text-align: center;
      margin-bottom: 35px;
    }

    .logo-icon {
      width: 70px;
      height: 70px;
      margin: 0 auto 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    h1 {
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #888;
      font-size: 14px;
      font-weight: 500;
    }

    /* ========== FORM ELEMENTS ========== */
    .form-group {
      margin-bottom: 18px;
      animation: fadeInUp 0.6s ease-out backwards;
    }

    .form-group:nth-child(1) { animation-delay: 0.1s; }
    .form-group:nth-child(2) { animation-delay: 0.2s; }
    .form-group:nth-child(3) { animation-delay: 0.3s; }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 14px;
      font-size: 15px;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
      background: #f8f9fa;
      color: #333;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    input::placeholder {
      color: #bbb;
    }

    /* PASSWORD TOGGLE ICON */
    .password-toggle {
      position: absolute;
      right: 16px;
      cursor: pointer;
      color: #667eea;
      font-size: 18px;
      transition: all 0.2s ease;
      user-select: none;
    }

    .password-toggle:hover {
      transform: scale(1.15);
      color: #764ba2;
    }

    /* ERROR MESSAGE */
    .error-message {
      display: none;
      margin-top: 8px;
      padding: 10px 14px;
      background: #ffe0e0;
      border-left: 4px solid #ff6b6b;
      border-radius: 8px;
      font-size: 13px;
      color: #d32f2f;
      font-weight: 500;
      animation: slideInError 0.3s ease;
    }

    @keyframes slideInError {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .error-message.show {
      display: block;
    }

    /* ========== BUTTONS ========== */
    .button-group {
      margin-top: 28px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    button {
      padding: 16px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.2);
      transition: left 0.5s ease;
    }

    button:hover::before {
      left: 100%;
    }

    #loginBtn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    #loginBtn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
    }

    #loginBtn:active:not(:disabled) {
      transform: translateY(-1px);
    }

    #loginBtn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    #googleLoginBtn {
      background: white;
      color: #333;
      border: 2px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    #googleLoginBtn:hover:not(:disabled) {
      background: #f8f9fa;
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }

    #googleLoginBtn img {
      width: 20px;
      height: 20px;
    }

    /* FORGOT PASSWORD */
    .forgot-section {
      text-align: center;
      margin-top: 20px;
    }

    .forgot-link {
      font-size: 14px;
      color: #667eea;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .forgot-link:hover {
      color: #764ba2;
      text-decoration: underline;
    }

    /* SIGNUP LINK */
    .signup-section {
      text-align: center;
      margin-top: 25px;
      padding-top: 25px;
      border-top: 1px solid #e0e0e0;
    }

    .signup-section p {
      font-size: 14px;
      color: #666;
    }

    .signup-link {
      color: #667eea;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .signup-link:hover {
      color: #764ba2;
    }

    /* LOADING SPINNER */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ========== TOAST CONTAINER ========== */
    .toast-container {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      pointer-events: none;
    }

    .toast {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 28px;
      border-radius: 20px;
      backdrop-filter: blur(20px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      pointer-events: auto;
      cursor: pointer;
      min-width: 320px;
      max-width: 420px;
      font-weight: 600;
      font-size: 16px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      animation: slideInBottom 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .toast.error {
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.95) 0%, rgba(238, 90, 111, 0.95) 100%);
      color: white;
    }

    .toast.success {
      background: linear-gradient(135deg, rgba(38, 208, 206, 0.95) 0%, rgba(26, 188, 156, 0.95) 100%);
      color: white;
    }

    .toast-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      background: rgba(255, 255, 255, 0.3);
      border: 2.5px solid rgba(255, 255, 255, 0.6);
      flex-shrink: 0;
      animation: iconBounce3D 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes iconBounce3D {
      0% {
        transform: scale(0.2) rotateZ(-30deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.15) rotateZ(10deg);
      }
      100% {
        transform: scale(1) rotateZ(0deg);
        opacity: 1;
      }
    }

    @keyframes slideInBottom {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .toast.removing {
      animation: fadeOutBottom 0.4s cubic-bezier(0.4, 0, 1, 1) forwards;
    }

    @keyframes fadeOutBottom {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(20px);
      }
    }

    /* Responsive */
    @media (max-width: 600px) {
      .login-container {
        padding: 35px 25px;
        border-radius: 24px;
      }

      h1 {
        font-size: 26px;
      }

      .logo-icon {
        width: 60px;
        height: 60px;
        font-size: 32px;
      }

      button {
        font-size: 15px;
        padding: 14px;
      }

      .toast {
        min-width: 280px;
        max-width: 85vw;
        font-size: 15px;
        padding: 16px 20px;
      }
    }
  </style>
</head>

<body>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Login Container -->
  <div class="login-container">
    <!-- Logo & Title -->
    <div class="logo-section">
      <div class="logo-icon">ðŸŽ“</div>
      <h1>Lenovox AI</h1>
      <p class="subtitle">Smart Learning for Everyone</p>
    </div>

    <!-- Email Input -->
    <div class="form-group">
      <label for="loginEmail"><i class="fas fa-envelope"></i> Email Address</label>
      <div class="input-wrapper">
        <input id="loginEmail" type="email" placeholder="your@email.com">
      </div>
      <div id="emailError" class="error-message"></div>
    </div>

    <!-- Password Input -->
    <div class="form-group">
      <label for="loginPassword"><i class="fas fa-lock"></i> Password</label>
      <div class="input-wrapper">
        <input id="loginPassword" type="password" placeholder="Enter your password">
        <i class="fas fa-eye password-toggle" id="passwordToggle" onclick="togglePassword()"></i>
      </div>
      <div id="passwordError" class="error-message"></div>
    </div>

    <!-- Login Button -->
    <div class="button-group">
      <button id="loginBtn">
        <i class="fas fa-sign-in-alt"></i> Login
      </button>

      <button id="googleLoginBtn">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
        Continue with Google
      </button>
    </div>

    <!-- Forgot Password -->
    <div class="forgot-section">
      <span class="forgot-link" id="forgotBtn">
        <i class="fas fa-key"></i> Forgot Password?
      </span>
    </div>

    <!-- Sign Up Link -->
    <div class="signup-section">
      <p>Don't have an account? <a href="signup.html" class="signup-link">Sign up here</a></p>
    </div>
  </div>

  <script type="module">
    import { loginUser, googleLoginUser, resetPassword } from "./auth.js";

    // ========== CONSTANTS ==========
    const LOGIN_EXPIRY_DAYS = 7;

    // ========== DETAILED ERROR MESSAGES ==========
    const errorMessages = {
      'invalid-email': 'Email format is wrong. Try: example@email.com',
      'user-not-found': 'No account found with this email. Did you sign up with a different email?',
      'empty-email': 'Please enter your email address.',
      'wrong-password': 'Password is incorrect. Passwords are case-sensitive, so check CAPS LOCK!',
      'empty-password': 'Please enter your password.',
      'user-disabled': 'This account has been disabled. Contact support@lenovox.ai for help.',
      'too-many-requests': 'Too many failed login attempts. Wait 15 minutes for security, then try again.',
      'network-request-failed': 'No internet connection. Check your WiFi or mobile data and try again.',
      'auth/invalid-credential': 'Email or password is incorrect. Please check both.',
      'auth/user-not-found': 'No account found with this email.',
      'auth/wrong-password': 'Password is incorrect. Try again!',
      'auth/too-many-requests': 'Too many login attempts. Wait 15 minutes before trying again.',
      'default': 'Something went wrong. Please try again or contact support.'
    };

    // ========== DOM ELEMENTS ==========
    const emailInput = document.getElementById('loginEmail');
    const passwordInput = document.getElementById('loginPassword');
    const loginBtn = document.getElementById('loginBtn');
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const forgotBtn = document.getElementById('forgotBtn');
    const passwordToggle = document.getElementById('passwordToggle');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');

    // ========== TOAST NOTIFICATION SYSTEM ==========
    function showToast(message, type = 'success', duration = 3000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;

      const icon = type === 'success' ? 'âœ“' : 'âœ•';
      toast.innerHTML = `
        <div class="toast-icon">${icon}</div>
        <div>${message}</div>
      `;

      container.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('removing');
        setTimeout(() => toast.remove(), 400);
      }, duration);

      toast.addEventListener('click', () => {
        toast.classList.add('removing');
        setTimeout(() => toast.remove(), 400);
      });
    }

    // ========== ERROR DISPLAY ==========
    function showError(fieldId, message) {
      const errorElement = document.getElementById(fieldId + 'Error');
      if (errorElement) {
        errorElement.textContent = message;
        errorElement.classList.add('show');
      }
    }

    function clearErrors() {
      emailError.classList.remove('show');
      passwordError.classList.remove('show');
    }

    // ========== GET ERROR MESSAGE ==========
    function getErrorMessage(errorCode) {
      if (!errorCode) return errorMessages['default'];
      
      for (const [key, message] of Object.entries(errorMessages)) {
        if (errorCode.includes(key) || key.includes(errorCode)) {
          return message;
        }
      }
      
      return errorMessages['default'];
    }

    // ========== PASSWORD TOGGLE ==========
    window.togglePassword = function() {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      passwordToggle.classList.toggle('fa-eye');
      passwordToggle.classList.toggle('fa-eye-slash');
    };

    // ========== LOGIN WITH EMAIL ==========
    loginBtn.addEventListener('click', async () => {
      clearErrors();
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      // Validation
      if (!email) {
        showError('email', errorMessages['empty-email']);
        return;
      }
      if (!password) {
        showError('password', errorMessages['empty-password']);
        return;
      }

      // Email format validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showError('email', errorMessages['invalid-email']);
        return;
      }

      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span class="spinner"></span> Logging in...';

      try {
        const result = await loginUser({ email, password });
        
        // Check if login was successful
        if (result.success) {
          showToast('Welcome back! Redirecting...', 'success', 2000);
          setTimeout(() => {
            window.location.href = 'appskeleton.html';
          }, 2000);
        } else {
          // Handle error from auth.js
          const message = getErrorMessage(result.error);
          showToast(message, 'error', 4500);

          if (result.error.includes('email') || result.error.includes('user-not-found')) {
            showError('email', message);
          } else if (result.error.includes('password') || result.error.includes('wrong-password')) {
            showError('password', message);
          }
        }
      } catch (err) {
        const message = getErrorMessage(err.message);
        showToast(message, 'error', 4500);
      } finally {
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
      }
    });

    // ========== LOGIN WITH GOOGLE ==========
    googleLoginBtn.addEventListener('click', async () => {
      clearErrors();
      googleLoginBtn.disabled = true;
      googleLoginBtn.innerHTML = '<span class="spinner"></span> Connecting...';

      try {
        const result = await googleLoginUser();
        
        if (result.success) {
          showToast('Google login successful!', 'success', 2000);
          setTimeout(() => {
            window.location.href = 'appskeleton.html';
          }, 2000);
        } else {
          const message = getErrorMessage(result.error);
          showToast(message, 'error', 4000);
        }
      } catch (err) {
        const message = getErrorMessage(err.message);
        showToast(message, 'error', 4000);
      } finally {
        googleLoginBtn.disabled = false;
        googleLoginBtn.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google"> Continue with Google';
      }
    });

    // ========== FORGOT PASSWORD ==========
    forgotBtn.addEventListener('click', async () => {
      const email = prompt('Enter your email address to reset your password:');
      if (!email) return;

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showToast(errorMessages['invalid-email'], 'error', 3500);
        return;
      }

      forgotBtn.style.opacity = '0.5';
      forgotBtn.style.pointerEvents = 'none';

      try {
        const result = await resetPassword(email);
        
        if (result.success) {
          showToast('Check your email! We sent a password reset link.', 'success', 4000);
        } else {
          const message = getErrorMessage(result.error);
          showToast(message, 'error', 4000);
        }
      } catch (err) {
        const message = getErrorMessage(err.message);
        showToast(message, 'error', 4000);
      } finally {
        forgotBtn.style.opacity = '1';
        forgotBtn.style.pointerEvents = 'auto';
      }
    });
    
    // ========== REAL-TIME EMAIL VALIDATION ==========
    emailInput.addEventListener('blur', () => {
      const email = emailInput.value.trim();
      if (email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showError('email', 'Email should include @ symbol. Example: student@email.com');
        } else {
          emailError.classList.remove('show');
        }
      }
    });

    // ========== CLEAR ERROR ON FOCUS ==========
    passwordInput.addEventListener('focus', () => {
      passwordError.classList.remove('show');
    });

    // ========== ENTER KEY SUPPORT ==========
    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') loginBtn.click();
    });
  </script>

</body>
</html
